<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>IoT Health Monitor — Demo</title>

<!-- Chart.js + jsPDF CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  :root{
    --bg:#f6f9ff; --card:#fff; --accent:#0a74ff; --accent2:#00c6ff; --muted:#65748b;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter, Poppins, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue";background:var(--bg);color:#0b2233}
  header{display:flex;justify-content:space-between;align-items:center;padding:14px 28px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;position:sticky;top:0;z-index:60}
  .brand{font-weight:700}
  nav{display:flex;gap:14px}
  nav a{color:white;text-decoration:none;font-weight:700;padding:8px 10px;border-radius:8px}
  nav a:hover{background:rgba(255,255,255,0.06)}
  .container{max-width:1150px;margin:28px auto;padding:0 18px}
  /* Hero top: show generated doctor image full, with overlay text centered */
  .hero-wrap{width:100%;display:block;overflow:hidden;border-radius:14px}
  .hero-img{
    width:100%; height:52vh; object-fit:contain; /* show full image, not cropped */
    display:block; background:#e9f5ff;
  }
  .hero-text{
    margin-top:-8vh; /* overlap slightly */
    background:linear-gradient(180deg,#fff,#fbfdff);
    padding:28px;border-radius:12px;box-shadow:0 18px 60px rgba(10,116,255,0.06);
    display:flex;gap:20px;align-items:center;justify-content:space-between;
    flex-wrap:wrap;
  }
  .hero-left{max-width:640px}
  .hero-left h1{font-size:2.6rem;color:var(--accent);margin:0 0 8px}
  .hero-left p{color:var(--muted);margin:0 0 12px}
  .cta{display:flex;gap:12px}
  .btn{padding:10px 16px;border-radius:999px;border:0;font-weight:700;cursor:pointer}
  .btn-primary{background:var(--accent2);color:#fff}
  .btn-ghost{background:transparent;color:var(--accent);border:1px solid rgba(10,116,255,0.12)}

  /* Page sections */
  section{margin-top:28px}
  .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 12px 30px rgba(11,59,121,0.04)}
  .features{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-top:12px}
  .feature{padding:14px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfdff);text-align:left}
  .feature img{width:100%;border-radius:8px;display:block;margin-bottom:10px}

  /* Live dashboard */
  .live-grid{display:grid;grid-template-columns:320px 1fr;gap:18px;margin-top:12px;align-items:start}
  .gauges{display:flex;flex-direction:column;gap:10px}
  .g-card{padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#f7fbff);text-align:center}
  .gLabel{font-weight:700;margin-top:8px}
  .chart-card{padding:12px}

  /* admin overlay */
  .overlay{position:fixed;inset:0;background:rgba(4,10,25,0.6);display:none;align-items:center;justify-content:center;z-index:300}
  .panel{background:#fff;padding:20px;border-radius:12px;width:90%;max-width:900px;box-shadow:0 30px 80px rgba(2,40,80,0.25)}

  footer{margin-top:28px;padding:18px;text-align:center;color:var(--muted)}

  @media(max-width:900px){
    .hero-left h1{font-size:1.8rem}
    .live-grid{grid-template-columns:1fr}
    .hero-img{height:44vh}
  }
</style>
</head>
<body>

<header>
  <div class="brand">IoT Health Monitor</div>
  <nav>
    <a href="#home" onclick="scrollTo('home')">Home</a>
    <a href="#dashboard" onclick="scrollTo('dashboard')">Dashboard</a>
    <a href="#doctor" onclick="scrollTo('doctor')">Doctor</a>
    <a href="#gym" onclick="scrollTo('gym')">Gym</a>
    <a href="#consult" onclick="scrollTo('consult')">Consult</a>
    <a href="#" onclick="openAdmin()">Admin</a>
  </nav>
</header>

<main class="container">
  <!-- HERO -->
  <section id="home" class="hero-wrap">
    <img class="hero-img" 
         src="https://images.pexels.com/photos/5450140/pexels-photo-5450140.jpeg" 
         alt="Doctor banner (generated)">
    <div class="hero-text card">
      <div class="hero-left">
        <h1>Smart Health Dashboard</h1>
        <p>Monitor your health parameters in real-time, anytime, anywhere. Doctors can consult remotely — gyms can monitor members live.</p>
        <div class="cta">
          <button class="btn btn-primary" onclick="scrollTo('dashboard')">View Dashboard</button>
          <button class="btn btn-ghost" onclick="scrollTo('consult')">Book Consultation</button>
        </div>
      </div>

      <div style="min-width:260px;">
        <div style="background:#f8fbff;padding:12px;border-radius:10px;text-align:left">
          <strong style="color:var(--accent)">Live Now</strong>
          <div style="margin-top:8px">BPM: <span id="miniBPM">--</span></div>
          <div>Temp: <span id="miniTemp">--</span> °C</div>
          <div>Hum: <span id="miniHum">--</span> %</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Dashboard / Live Data -->
  <section id="dashboard">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
      <h2 style="color:var(--accent)">Health Dashboard</h2>
      <div>
        <button class="btn btn-ghost" onclick="downloadCSV()">Download CSV</button>
        <button class="btn btn-primary" onclick="downloadPDF()">Download Report (PDF)</button>
      </div>
    </div>

    <div class="card">
      <div style="color:var(--muted)">Real-time readings (auto-refresh every 15 seconds)</div>

      <div class="live-grid">
        <!-- left: gauges + stats -->
        <aside>
          <div class="gauges">
            <div class="g-card">
              <canvas id="gaugeBPM" width="240" height="120"></canvas>
              <div class="gLabel" id="gLabelBPM">-- BPM</div>
            </div>
            <div class="g-card">
              <canvas id="gaugeTemp" width="240" height="120"></canvas>
              <div class="gLabel" id="gLabelTemp">-- °C</div>
            </div>
            <div class="g-card">
              <canvas id="gaugeHum" width="240" height="120"></canvas>
              <div class="gLabel" id="gLabelHum">-- %</div>
            </div>
          </div>
        </aside>

        <!-- right: live line chart -->
        <div class="chart-card">
          <h3 style="margin-top:0">Real-time Chart</h3>
          <canvas id="lineChart" style="width:100%;height:360px"></canvas>
        </div>
      </div>
    </div>
  </section>

  <!-- Doctor -->
  <section id="doctor" style="margin-top:18px">
    <h2 style="color:var(--accent)">Doctor Monitoring</h2>
    <div class="card">
      <div style="display:flex;gap:16px;align-items:center;flex-wrap:wrap">
        <div style="flex:1">
          <h3>Remote Consultations</h3>
          <p style="color:var(--muted)">Clinicians can monitor patient vitals live and schedule teleconsultations based on alerts and trends.</p>
        </div>
        <div style="width:360px">
          <img src="https://images.pexels.com/photos/3786134/pexels-photo-3786134.jpeg" 
               style="width:100%;border-radius:10px" 
               alt="Doctor teleconsult">
        </div>
      </div>
    </div>
  </section>

  <!-- Gym -->
  <section id="gym" style="margin-top:18px">
    <h2 style="color:var(--accent)">Gym Integration</h2>
    <div class="card">
      <div style="display:grid;grid-template-columns:1fr 320px;gap:16px;align-items:center">
        <div>
          <p style="color:var(--muted)">Use wearables and live dashboards to monitor class participants and provide safer training with instant alerts when vitals exceed safe thresholds.</p>
        </div>
        <div>
          <img src="https://images.pexels.com/photos/4324027/pexels-photo-4324027.jpeg" 
               style="width:100%;border-radius:10px" 
               alt="Gym monitoring">
        </div>
      </div>
    </div>
  </section>

  <!-- Consult -->
  <section id="consult" style="margin-top:18px">
    <h2 style="color:var(--accent)">Book Consultation</h2>
    <div class="card" style="max-width:820px;margin:0 auto">
      <form id="bookingForm" style="display:grid;gap:10px">
        <input id="bkName" placeholder="Full name" style="padding:10px;border-radius:8px;border:1px solid #e6eefc" required>
        <input id="bkEmail" placeholder="Email" type="email" style="padding:10px;border-radius:8px;border:1px solid #e6eefc" required>
        <input id="bkPhone" placeholder="Phone (optional)" style="padding:10px;border-radius:8px;border:1px solid #e6eefc">
        <select id="bkReason" style="padding:10px;border-radius:8px;border:1px solid #e6eefc">
          <option>Remote patient monitoring</option>
          <option>Gym integration / demo</option>
          <option>Technical integration</option>
        </select>
        <textarea id="bkNotes" rows="4" placeholder="Notes (optional)" style="padding:10px;border-radius:8px;border:1px solid #e6eefc"></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button type="button" class="btn btn-ghost" onclick="document.getElementById('bookingForm').reset()">Clear</button>
          <button type="submit" class="btn btn-primary">Send Booking</button>
        </div>
      </form>
    </div>
  </section>

  <footer>
    <div style="max-width:1100px;margin:0 auto;display:flex;justify-content:space-between;gap:12px;align-items:center;flex-wrap:wrap">
      <div>Developed by <strong>Thapelo Mokoa</strong> — IoT Health Monitoring © 2025</div>
      <div style="color:var(--muted)">Channel: <strong>3128115</strong></div>
    </div>
  </footer>
</main>

<!-- Admin overlay -->
<div id="adminOverlay" class="overlay" style="display:none">
  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Admin Panel</strong>
      <div>
        <button class="btn btn-ghost" onclick="closeAdmin()">Close</button>
      </div>
    </div>

    <div id="adminContent" style="margin-top:12px">
      <div id="adminLogin">
        <p style="color:var(--muted)">Enter admin credentials (demo): username <code>admin</code> / password <code>1234</code></p>
        <input id="adminUser" placeholder="Username" style="padding:10px;border-radius:8px;border:1px solid #e6eefc;margin-right:8px">
        <input id="adminPass" placeholder="Password" type="password" style="padding:10px;border-radius:8px;border:1px solid #e6eefc">
        <div style="margin-top:8px">
          <button class="btn btn-primary" onclick="adminLogin()">Login</button>
        </div>
      </div>

      <div id="adminDashboard" style="display:none">
        <h3 style="margin-top:10px">Recent ThingSpeak Feeds</h3>
        <div style="margin-bottom:8px">
          <button class="btn btn-ghost" onclick="adminFetch()">Refresh feeds</button>
          <button class="btn btn-primary" onclick="downloadCSV()">Download CSV</button>
        </div>
        <div style="max-height:300px;overflow:auto;border-radius:8px;border:1px solid #eef3fb;padding:8px">
          <table id="feedsTable" style="width:100%;border-collapse:collapse">
            <thead><tr><th>Time</th><th>BPM</th><th>Temp</th><th>Hum</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
/* ========================
   Config: ThingSpeak
   ======================== */
const CHANNEL_ID = "3128115";
const READ_KEY = "K72OYJMYOJZN240T";
const POLL_INTERVAL = 15000;
const POINTS = 24;

const $ = id => document.getElementById(id);

function scrollTo(id){
  const el = document.getElementById(id);
  if(!el) return;
  el.scrollIntoView({behavior:'smooth', block:'start'});
}

document.getElementById('bookingForm').addEventListener('submit', (e)=>{
  e.preventDefault();
  const name = $('bkName').value.trim();
  const email = $('bkEmail').value.trim();
  const phone = $('bkPhone').value.trim();
  const reason = $('bkReason').value;
  const notes = $('bkNotes').value.trim();
  if(!name || !email){ alert('Enter name and email'); return; }
  const subject = encodeURIComponent(`Consultation booking: ${name}`);
  const body = encodeURIComponent(`Name: ${name}\nEmail: ${email}\nPhone: ${phone}\nReason: ${reason}\n\nNotes:\n${notes}`);
  window.location.href = `mailto:thapelomokoa.projects@gmail.com?subject=${subject}&body=${body}`;
});

/* Charts */
const gaugeBPM = new Chart($('gaugeBPM').getContext('2d'), {
  type: 'doughnut',
  data: { labels:['value','rest'], datasets:[{ data:[0,100], backgroundColor:['#ff4d4f','#f0f4ff'], borderWidth:0 }] },
  options:{ cutout:'80%', rotation:-Math.PI*1.1, circumference:Math.PI*1.2, plugins:{legend:{display:false}, tooltip:{enabled:false}}}
});
const gaugeTemp = new Chart($('gaugeTemp').getContext('2d'), {
  type: 'doughnut',
  data: { labels:['value','rest'], datasets:[{ data:[0,100], backgroundColor:['#ff9800','#f0f4ff'], borderWidth:0 }] },
  options:{ cutout:'80%', rotation:-Math.PI*1.1, circumference:Math.PI*1.2, plugins:{legend:{display:false}, tooltip:{enabled:false}}}
});
const gaugeHum = new Chart($('gaugeHum').getContext('2d'), {
  type: 'doughnut',
  data: { labels:['value','rest'], datasets:[{ data:[0,100], backgroundColor:['#00bcd4','#f0f4ff'], borderWidth:0 }] },
  options:{ cutout:'80%', rotation:-Math.PI*1.1, circumference:Math.PI*1.2, plugins:{legend:{display:false}, tooltip:{enabled:false}}}
});

const lineCtx = $('lineChart').getContext('2d');
const lineChart = new Chart(lineCtx, {
  type:'line',
  data:{ labels:[], datasets:[
    {label:'BPM',data:[],borderColor:'#ff4d4f',fill:false,tension:0.3},
    {label:'Temp °C',data:[],borderColor:'#ff9800',fill:false,tension:0.3},
    {label:'Hum %',data:[],borderColor:'#00bcd4',fill:false,tension:0.3},
  ]},
  options:{responsive:true,plugins:{legend:{display:true}}}
});

/* Fetch ThingSpeak */
let lastData=[];
async function fetchTS(){
  try{
    const res = await fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${READ_KEY}&results=${POINTS}`);
    const data = await res.json();
    const feeds = data.feeds||[];
    if(feeds.length===0) return;
    lastData = feeds.map(f=>({bpm:+f.field1, temp:+f.field2, hum:+f.field3, ts:f.created_at}));
    updateUI();
  }catch(err){console.error(err);}
}
function updateUI(){
  if(!lastData.length) return;
  const latest = lastData[lastData.length-1];
  $('miniBPM').textContent = latest.bpm;
  $('miniTemp').textContent = latest.temp;
  $('miniHum').textContent = latest.hum;
  // Gauges
  gaugeBPM.data.datasets[0].data=[latest.bpm,100-latest.bpm]; gaugeBPM.update();
  gaugeTemp.data.datasets[0].data=[latest.temp,100-latest.temp]; gaugeTemp.update();
  gaugeHum.data.datasets[0].data=[latest.hum,100-latest.hum]; gaugeHum.update();
  // Line chart
  lineChart.data.labels = lastData.map(d=>new Date(d.ts).toLocaleTimeString());
  lineChart.data.datasets[0].data = lastData.map(d=>d.bpm);
  lineChart.data.datasets[1].data = lastData.map(d=>d.temp);
  lineChart.data.datasets[2].data = lastData.map(d=>d.hum);
  lineChart.update();
}
setInterval(fetchTS,POLL_INTERVAL);
fetchTS();

/* CSV Download */
function downloadCSV(){
  if(!lastData.length) return alert('No data yet');
  const header = ['Time,BPM,Temp,Hum'];
  const rows = lastData.map(d=>`${d.ts},${d.bpm},${d.temp},${d.hum}`);
  const csv = header.concat(rows).join('\n');
  const blob = new Blob([csv],{type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='health_data.csv'; a.click(); URL.revokeObjectURL(url);
}

/* PDF */
function downloadPDF(){
  if(!lastData.length) return alert('No data yet');
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("IoT Health Monitoring Report",14,14);
  let y=20;
  doc.setFontSize(10);
  lastData.forEach(d=>{
    if(y>280){doc.addPage();y=20;}
    doc.text(`${d.ts} | BPM:${d.bpm} | Temp:${d.temp}°C | Hum:${d.hum}%`,14,y);
    y+=6;
  });
  doc.save("health_report.pdf");
}

/* Admin */
function openAdmin(){$('adminOverlay').style.display='flex';}
function closeAdmin(){$('adminOverlay').style.display='none';$('adminLogin').style.display='block';$('adminDashboard').style.display='none';}
function adminLogin(){
  const u=$('adminUser').value.trim();
  const p=$('adminPass').value.trim();
  if(u==='admin' && p==='1234'){ $('adminLogin').style.display='none'; $('adminDashboard').style.display='block'; adminFetch();}
  else alert('Wrong credentials');
}
async function adminFetch(){ await fetchTS(); const tbody=$('feedsTable').querySelector('tbody'); tbody.innerHTML=''; lastData.forEach(d=>{
  const tr=document.createElement('tr');
  tr.innerHTML=`<td>${d.ts}</td><td>${d.bpm}</td><td>${d.temp}</td><td>${d.hum}</td>`;
  tbody.appendChild(tr);
}); }
</script>

</body>
</html>
