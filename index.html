/**
 * Google Apps Script Web App to receive consult form submissions and append to a Google Sheet.
 * Save this in the Apps Script editor attached to the Google Sheet you want to use.
 */

function doPost(e) {
  try {
    var ss = SpreadsheetApp.getActiveSpreadsheet();
    var sheet = ss.getActiveSheet();

    // If content-type is JSON (our HTML posts JSON), parse it differently
    var body;
    if (e.postData && e.postData.type === "application/json") {
      body = JSON.parse(e.postData.contents);
    } else {
      body = e.parameter || {};
    }

    var name = body.name || '';
    var email = body.email || '';
    var message = body.message || body.msg || '';
    var channel = body.channel || '';

    // Append to sheet: Timestamp, Name, Email, Channel, Message
    sheet.appendRow([ new Date(), name, email, channel, message ]);

    // Return success JSON
    return ContentService
      .createTextOutput(JSON.stringify({status: 'success'}))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (err) {
    return ContentService
      .createTextOutput(JSON.stringify({status: 'error', error: err.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Optional: allow GET for testing
function doGet(e){
  return ContentService.createTextOutput(JSON.stringify({status:'ready'})).setMimeType(ContentService.MimeType.JSON);
}
