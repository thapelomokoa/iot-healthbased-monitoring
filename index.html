<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IoT Health Monitor & Dashboard</title>
<style>
body { margin:0; font-family:'Arial',sans-serif; background:#f8f9fa; color:#333; scroll-behavior:smooth; }
.navbar { position:fixed; top:0; width:100%; background:#4facfe; display:flex; justify-content:center; gap:20px; padding:10px; z-index:100; }
.navbar a { color:#fff; text-decoration:none; font-weight:bold; }
.section { opacity:0; transform:translateY(50px); transition:all 0.8s ease; padding:80px 20px 40px; }
.section.visible { opacity:1; transform:translateY(0); }
.hero { background:linear-gradient(90deg,#4facfe,#00f2fe); color:#fff; text-align:center; padding:140px 20px 80px; position:relative; }
.hero h1 { font-size:3em; margin-bottom:10px; }
.hero p { font-size:1.2em; margin-bottom:20px; }
.btn { padding:10px 20px; margin:5px; border-radius:8px; border:none; cursor:pointer; color:#fff; background:#007bff; text-decoration:none; }
.widgets { display:flex; flex-wrap:wrap; gap:20px; margin-bottom:20px; justify-content:center; }
.widget { flex:1 1 150px; background:#e9f5ff; padding:20px; border-radius:12px; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
.heartbeat { font-size:2em; animation:beat 1s infinite alternate; }
@keyframes beat { 0%{transform:scale(1);}50%{transform:scale(1.2);}100%{transform:scale(1);} }
table { width:100%; border-collapse:collapse; margin-top:20px; }
table th, table td { border:1px solid #ccc; padding:10px; text-align:center; }
table th { background:#4facfe; color:#fff; }
.leaderboard ul { list-style:none; padding:0; }
.leaderboard li { background:#e9f5ff; margin-bottom:5px; padding:10px; border-radius:8px; }
form { display:flex; flex-direction:column; max-width:400px; margin:auto; gap:10px; }
input, select { padding:10px; border-radius:8px; border:1px solid #ccc; }
.alert { color:red; font-weight:bold; animation:flash 1s infinite alternate; }
@keyframes flash {0%,100%{opacity:1;}50%{opacity:0.4;}}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<nav class="navbar">
  <a href="#hero">Home</a>
  <a href="#register">Register</a>
  <a href="#dashboard">Dashboard</a>
  <a href="#doctor">Doctor</a>
  <a href="#gym">Gym</a>
</nav>

<section id="hero" class="hero section visible">
  <h1>Monitor Your Health Anywhere</h1>
  <p>Real-Time Heart Rate, Temperature & Humidity | Online Doctor Access | Gym Monitoring</p>
  <a class="btn" href="#register">Register</a>
  <a class="btn" href="#dashboard">View Dashboard</a>
</section>

<section id="register" class="section container">
  <h2>Patient Registration</h2>
  <form id="registerForm">
    <input type="text" id="name" placeholder="Full Name" required>
    <input type="number" id="age" placeholder="Age" required>
    <select id="role">
      <option value="patient">Patient</option>
      <option value="nurse">Nurse</option>
      <option value="doctor">Doctor</option>
    </select>
    <button type="submit" class="btn">Register</button>
  </form>
</section>

<section id="dashboard" class="section container">
  <h2>Patient Dashboard</h2>
  <div class="widgets">
    <div class="widget heartbeat">‚ù§Ô∏è <span id="bpmValue">--</span></div>
    <div class="widget">Temp: <span id="tempValue">--</span> ¬∞C</div>
    <div class="widget">Humidity: <span id="humValue">--</span> %</div>
    <div class="widget">Health Score: <span id="healthScore">--</span></div>
  </div>
  <canvas id="combinedChart" height="150"></canvas>
  <button onclick="downloadPDF()">Download PDF</button>
  <button onclick="downloadCSV()">Download CSV</button>
  <div id="alerts"></div>
</section>

<section id="doctor" class="section container">
  <h2>Doctor Dashboard</h2>
  <p>Doctors can monitor multiple patients in real-time and provide consultations.</p>
  <table id="doctorTable">
    <thead><tr><th>Patient</th><th>BPM</th><th>Temp</th><th>Humidity</th><th>Status</th><th>Consult</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<section id="gym" class="section container">
  <h2>Gym Dashboard</h2>
  <p>Gyms can monitor multiple members' vitals for safety and performance.</p>
  <div class="leaderboard">
    <h3>Member Leaderboard</h3>
    <ul id="leaderboardList"></ul>
  </div>
</section>

<section id="howItWorks" class="section container">
  <h2>How to Use the Hardware</h2>
  <ol>
    <li>Place your finger on the pulse sensor.</li>
    <li>Arduino reads BPM; DHT22 reads temperature & humidity.</li>
    <li>ESP8266 sends data to ThingSpeak cloud.</li>
    <li>Website dashboard updates live with readings.</li>
    <li>Doctor or nurse can view your data and provide feedback.</li>
  </ol>
</section>

<footer>Contact info | Privacy Policy | Terms of Service</footer>

<script>
let users=[];
const CHANNEL_ID='3128115';
const READ_KEY='K72OYJMYOJZN240T';
let bpmData=[],tempData=[],humData=[];

document.getElementById('registerForm').addEventListener('submit', e=>{
  e.preventDefault();
  const name=document.getElementById('name').value;
  const age=document.getElementById('age').value;
  const role=document.getElementById('role').value;
  users.push({name,age,role});
  alert(`${role.charAt(0).toUpperCase()+role.slice(1)} registered successfully!`);
});

async function fetchThingSpeak(){
  try{
    const res=await fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${READ_KEY}&results=20`);
    const data=await res.json();
    bpmData=data.feeds.map(f=>parseInt(f.field1||0));
    tempData=data.feeds.map(f=>parseFloat(f.field2||0));
    humData=data.feeds.map(f=>parseFloat(f.field3||0));
    updateDashboard();
  }catch(e){console.error(e);}
}

function updateDashboard(){
  const bpm=bpmData[bpmData.length-1]||0;
  const temp=tempData[tempData.length-1]||0;
  const hum=humData[humData.length-1]||0;
  document.getElementById('bpmValue').textContent=bpm;
  document.getElementById('tempValue').textContent=temp;
  document.getElementById('humValue').textContent=hum;
  const healthScore=Math.round((bpm/120 + temp/40 + hum/100)/3*100);
  document.getElementById('healthScore').textContent=isNaN(healthScore)? '--': healthScore;

  const alertDiv=document.getElementById('alerts');
  alertDiv.innerHTML='';
  if(bpm>100 || temp>38 || hum>80){
    const a=document.createElement('div'); a.className='alert';
    a.textContent='Alert: One or more readings are above normal thresholds!';
    alertDiv.appendChild(a);
  }

  renderCombinedChart();
  updateDoctorTable();
  updateLeaderboard();
}

function updateDoctorTable(){
  const tbody=document.querySelector('#doctorTable tbody');
  tbody.innerHTML='';
  users.filter(u=>u.role==='patient').forEach(u=>{
    const bpm=bpmData[bpmData.length-1]||'--';
    const temp=tempData[tempData.length-1]||'--';
    const hum=humData[humData.length-1]||'--';
    const status=bpm>100?'üî¥':(bpm<60?'üü°':'üü¢');
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${u.name}</td><td>${bpm}</td><td>${temp}</td><td>${hum}</td><td>${status}</td><td><a href='#'>Consult</a></td>`;
    tbody.appendChild(tr);
  });
}

function updateLeaderboard(){
  const list=document.getElementById('leaderboardList');
  list.innerHTML='';
  users.filter(u=>u.role==='patient').forEach(u=>{
    const bpm=bpmData[bpmData.length-1]||0;
    const li=document.createElement('li');
    li.textContent=`${u.name}: ${bpm} BPM`;
    list.appendChild(li);
  });
}

let combinedChart;
function renderCombinedChart(){
  const labels=bpmData.map((_,i)=>i+1);
  if(!combinedChart){
    combinedChart=new Chart(document.getElementById('combinedChart').getContext('2d'),{
      type:'line',
      data:{labels,datasets:[
        {label:'BPM', data:bpmData, borderColor:'red', fill:false},
        {label:'Temp ¬∞C', data:tempData, borderColor:'orange', fill:false},
        {label:'Humidity %', data:humData, borderColor:'blue', fill:false}
      ]},
      options:{responsive:true, interaction:{mode:'index', intersect:false}, stacked:false}
    });
  } else {
    combinedChart.data.labels=labels;
    combinedChart.data.datasets[0].data=bpmData;
    combinedChart.data.datasets[1].data=tempData;
    combinedChart.data.datasets[2].data=humData;
    combinedChart.update();
  }
}

function downloadCSV(){
  let csv='BPM,Temp,Humidity\n';
  for(let i=0;i<bpmData.length;i++){csv+=`${bpmData[i]},${tempData[i]},${humData[i]}\n`;}
  const blob=new Blob([csv],{type:'text/csv'});
  const link=document.createElement('a'); link.href=URL.createObjectURL(blob); link.download='health_data.csv'; link.click();
}

function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const doc=new jsPDF(); doc.text('Health Data Report',10,10);
  for(let i=0;i<bpmData.length;i++){ doc.text(`BPM:${bpmData[i]} Temp:${tempData[i]} Hum:${humData[i]}`,10,20+i*10); }
  doc.save('health_report.pdf');
}

setInterval(fetchThingSpeak,5000);
fetchThingSpeak();
</script>
</body>
</html>
